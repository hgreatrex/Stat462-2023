<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>STAT-462 Lab Book - Lab 4: LINE and transformations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./in_S462_Lab0Index.html">Labs</a></li><li class="breadcrumb-item"><a href="./in_S462_Lab4.html">Lab 4: LINE and transformations</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">STAT-462 Lab Book</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Labs</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Lab0Index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab Q&amp;A</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Lab1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1: R intro</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Lab2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2: Scatterplots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Lab3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3: Simple Linear Regression (THIS WEEK)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Lab4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Lab 4: LINE and transformations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Lab5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 5: MLR</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Project</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Project00Index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Project01MakingGroups.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Making teams</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Project02Setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Causal Chains</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Project03InitialEDA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Initial EDA (this week)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Project04Final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Final Project Report</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Project04FinalUPDATED.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Final Project Report UPDATED CODE</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Tutorial01WhatisR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T1: R Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Tutorial02BeforeEachLab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T2. Before Each Lab</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Tutorial03RBasics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T3: Console-Basics and help</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Tutorial04AdvancedMarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T4: Advanced Markdown</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Tutorial05LoadingData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T5: Loading Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Tutorial06Wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T6: Summaries filtering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Tutorial07Distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T7: Normal, T Distributions and tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Tutorial08Plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T8: Making plots</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Tutorial09Correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T9: Correlation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./in_S462_Tutorial10Regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">T10: Regression</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#welcome-to-lab-4" id="toc-welcome-to-lab-4" class="nav-link active" data-scroll-target="#welcome-to-lab-4">Welcome to Lab 4</a>
  <ul class="collapse">
  <li><a href="#getting-started---do-not-skip" id="toc-getting-started---do-not-skip" class="nav-link" data-scroll-target="#getting-started---do-not-skip">Getting started - DO NOT SKIP</a>
  <ul class="collapse">
  <li><a href="#make-a-new-project-and-markdown-file" id="toc-make-a-new-project-and-markdown-file" class="nav-link" data-scroll-target="#make-a-new-project-and-markdown-file">1. Make a new project and markdown file</a></li>
  </ul></li>
  <li><a href="#code-showcase" id="toc-code-showcase" class="nav-link" data-scroll-target="#code-showcase">2. Code showcase</a></li>
  <li><a href="#florida-fish-challenge" id="toc-florida-fish-challenge" class="nav-link" data-scroll-target="#florida-fish-challenge">3. Florida Fish Challenge</a></li>
  </ul></li>
  <li><a href="#part-3-florida-fish-and-mercury-poisoning" id="toc-part-3-florida-fish-and-mercury-poisoning" class="nav-link" data-scroll-target="#part-3-florida-fish-and-mercury-poisoning">PART 3: Florida Fish and Mercury poisoning</a>
  <ul class="collapse">
  <li><a href="#background---read-it" id="toc-background---read-it" class="nav-link" data-scroll-target="#background---read-it">Background - READ IT</a>
  <ul class="collapse">
  <li><a href="#more-details" id="toc-more-details" class="nav-link" data-scroll-target="#more-details">More details</a></li>
  </ul></li>
  <li><a href="#goal" id="toc-goal" class="nav-link" data-scroll-target="#goal">Goal</a>
  <ul class="collapse">
  <li><a href="#obtain-the-data" id="toc-obtain-the-data" class="nav-link" data-scroll-target="#obtain-the-data">1. Obtain the data</a></li>
  <li><a href="#describe-the-study" id="toc-describe-the-study" class="nav-link" data-scroll-target="#describe-the-study">2 . Describe the study</a></li>
  <li><a href="#eda" id="toc-eda" class="nav-link" data-scroll-target="#eda">3. EDA</a></li>
  <li><a href="#correlation" id="toc-correlation" class="nav-link" data-scroll-target="#correlation">4. Correlation</a></li>
  <li><a href="#simple-linear-model" id="toc-simple-linear-model" class="nav-link" data-scroll-target="#simple-linear-model">5. Simple Linear Model</a></li>
  <li><a href="#check-line" id="toc-check-line" class="nav-link" data-scroll-target="#check-line">6. Check LINE</a></li>
  <li><a href="#residuals" id="toc-residuals" class="nav-link" data-scroll-target="#residuals">7. Residuals</a></li>
  <li><a href="#transformations" id="toc-transformations" class="nav-link" data-scroll-target="#transformations">8. Transformations</a></li>
  <li><a href="#new-lake" id="toc-new-lake" class="nav-link" data-scroll-target="#new-lake">9. New Lake</a></li>
  <li><a href="#more-complex" id="toc-more-complex" class="nav-link" data-scroll-target="#more-complex">10. More complex</a></li>
  </ul></li>
  <li><a href="#submitting-your-lab" id="toc-submitting-your-lab" class="nav-link" data-scroll-target="#submitting-your-lab">11. Submitting your Lab</a></li>
  </ul></li>
  <li><a href="#grading-rubricchecklist" id="toc-grading-rubricchecklist" class="nav-link" data-scroll-target="#grading-rubricchecklist">Grading Rubric/checklist</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 4: LINE and transformations</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="welcome-to-lab-4" class="level1">
<h1>Welcome to Lab 4</h1>
<p>The aim of this lab is to continue to get used to simple linear regression in R.</p>
<p>The Canvas page for this lab is:</p>
<p><strong>If the labs are causing major problems with your computer or your computer hardware is struggling (or you have any other software issue), Talk to Dr Greatrex and REMEMBER YOU CAN ALWAYS USE RSTUDIO CLOUD</strong>.<br>
</p>
<p>IF YOU CANNOT DOWNLOAD SF ON R-STUDIO CLOUD, PLEASE LET DR G KNOW</p>
<section id="getting-started---do-not-skip" class="level2">
<h2 class="anchored" data-anchor-id="getting-started---do-not-skip">Getting started - DO NOT SKIP</h2>
<p>We will start removing style marks for lab write-ups that have missed this sectino</p>
<section id="make-a-new-project-and-markdown-file" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="make-a-new-project-and-markdown-file">1. Make a new project and markdown file</h3>
<p>Follow <a href="https://psu-spatial.github.io/Stat462-2023/in_S462_Tutorial02BeforeEachLab.html">Tutorial 2 (link working)</a> to create a new project and a new RMarkdown file that knits.</p>
<p>You should now have a new project and a new RMarkdown file that knits.</p>
<p>Create a code chunk near the top and load these packages. You may need to install them first using <a href="https://psu-spatial.github.io/Stat462-2023/in_S462_Tutorial02BeforeEachLab.html#add-the-r-packages-you-need">Tutorial 2.3 (Link working)</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>) <span class="co"># Lots of data processing commands</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"knitr"</span>)     <span class="co"># Helps make good output files</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)   <span class="co"># Output plots</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"rmarkdown"</span>) <span class="co"># Helps make good output files</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"lattice"</span>)   <span class="co"># Makes nice plots</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"RColorBrewer"</span>) <span class="co"># Makes nice color-scales</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"skimr"</span>)     <span class="co"># Summary statistics</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"Stat2Data"</span>) <span class="co"># Regression specific commands</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"corrplot"</span>)  <span class="co"># correlation plots</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"GGally"</span>)    <span class="co"># correlation plots</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggpubr"</span>)    <span class="co"># QQplots</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"olsrr"</span>)     <span class="co"># Regression specific commands</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"plotly"</span>)    <span class="co"># Interactive plots</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"readxl"</span>)    <span class="co"># Read from excel files</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"equatiomatic"</span>) <span class="co"># extract equations</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggstatsplot"</span>) <span class="co"># Make nice plots</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"visreg"</span>) <span class="co">#visualise regression outputs</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"MASS"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="do">## you may need additional libraries or to install some of these.  </span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Just install them and add them to this list if you get errors.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Step D:</strong> Finally, press knit to check the html works and your theme works.</p>
</section>
</section>
<section id="code-showcase" class="level2">
<h2 class="anchored" data-anchor-id="code-showcase">2. Code showcase</h2>
<p>IF YOU IGNORED STEP 1 ABOVE GO BACK AND DO IT! You lose marks for things like no theme, poor headings etc.</p>
</section>
<section id="florida-fish-challenge" class="level2">
<h2 class="anchored" data-anchor-id="florida-fish-challenge">3. Florida Fish Challenge</h2>
</section>
</section>
<section id="part-3-florida-fish-and-mercury-poisoning" class="level1">
<h1>PART 3: Florida Fish and Mercury poisoning</h1>
<section id="background---read-it" class="level2">
<h2 class="anchored" data-anchor-id="background---read-it">Background - READ IT</h2>
<p>(remember google translate if/as needed)</p>
<p>Small amounts of the element mercury are present in many foods. They do not normally affect your health, but too much mercury can be poisonous. Although mercury is naturally occurring, the amounts in the environment have been on the rise from industrialization.</p>
<section id="more-details" class="level3">
<h3 class="anchored" data-anchor-id="more-details">More details</h3>
<p>More details here:</p>
<ul>
<li>https://www.wearecognitive.com/project/extra-narrative/bbc-mercury</li>
<li>https://medium.com/predict/mercury-pollution-reaches-the-deep-sea-f59a4938dc7c</li>
</ul>
<p>In the late 1980s, there were widespread public safety concerns in Florida about high mercury concentrations in sport fish. In 1989, the State of Florida issued an advisory urging the public to limit consumption of “top level” predatory fish from Lake Tohopekaliga and connected waters: including largemouth bass (Micropterus salmoides), bowfin (Amia calva), and gar (Lepisosteus spp.). This severely impacted tourism and the economy in the area.</p>
<p>Urgent research was required to inform public policy about which lakes needed to be closed.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Figures/Fig06_2Fish.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption class="figure-caption">a. (Left): The mercury food chain in fish.(Wikimedia commons, Bretwood Higman, Ground Truth Trekking) b. (middle) A large bass caught and released in a central Florida lake (https://www.wired2fish.com/news/young-man-catches-releases-huge-bass-from-bank/) c.&nbsp;(right). The location of the lakes in Florida (Google maps)</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="goal" class="level2">
<h2 class="anchored" data-anchor-id="goal">Goal</h2>
<p>We are going to reproduce part of one study on the topic conducted by T.R. Lange in 1993.</p>
<p>Dr Lange and their team took samples from 53 lakes in the Central Florida area. Using water samples collected from each of the lakes, the researchers measured the pH level, as well as the amount of chlorophyll, calcium and alkalinity. The Mercury concentration in the muscle tissue of lake fish was also recorded.</p>
<p>The units of the your dataset are:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;"><strong>Variable</strong></th>
<th style="text-align: center;"><strong>Unit</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Chlorophyll</td>
<td style="text-align: center;">micrograms/Litre, <span class="math inline">\(\mu g/L\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">Alkalinity</td>
<td style="text-align: center;">miligrams/Litre, <span class="math inline">\(mg/L\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;">pH</td>
<td style="text-align: center;">Unitless</td>
</tr>
<tr class="even">
<td style="text-align: center;">Calcium</td>
<td style="text-align: center;">miligrams/Litre, <span class="math inline">\(mg/L\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Mercury</td>
<td style="text-align: center;">Micrograms, <span class="math inline">\(\mu g\)</span></td>
</tr>
</tbody>
</table>
<p>The data is stored on Canvas in <strong>bass.csv</strong>.</p>
<p>You can see part of the paper here: https://www.researchgate.net/publication/15388314_Mercury_accumulation_in_largemouth_bass_Micropterus_salmoides_in_a_Florida_Lake</p>
<p><strong>You have been asked to assess whether the alkalinity levels of a lake might impact Mercury levels in largemouth bass. You will be presenting your results to the Mayor of Orlando in order to set new fishing regulations.</strong></p>
<section id="obtain-the-data" class="level3">
<h3 class="anchored" data-anchor-id="obtain-the-data">1. Obtain the data</h3>
<p>Obtain the data from Canvas and put it in your project folder. Use read_excel to read it into R and save it as a variable called <code>bass</code>. e.g.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>bass <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"bass.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="describe-the-study" class="level3">
<h3 class="anchored" data-anchor-id="describe-the-study">2 . Describe the study</h3>
<p><strong>Step 1:</strong> If you skipped it, go back and read the brief above. Seriously, it will save you time. Now describe what you are trying to do and the data available, including</p>
<ul>
<li>Why people who care about Mercury poisoning are looking at fish (use the reference links)</li>
<li>What you are trying to achieve</li>
<li>The data available and what population you are planning to apply it to</li>
<li>The object of analysis,</li>
<li>The variables and their units (especially identifying the response variable)</li>
</ul>
<p>Use headings/sub-headings etc to make your write up easy to read (click on Visual)</p>
</section>
<section id="eda" class="level3">
<h3 class="anchored" data-anchor-id="eda">3. EDA</h3>
<ol type="a">
<li><p>Conduct a quick exploratory analysis of the data using commands like skim (read ahead first!). In the text describe how much data is available, is there missing data and any other interesting features. If you already did this above, just refer to what you did.</p></li>
<li><p>Make a histogram of the response variable and use any method you see fit to assess its normality. Describe your findings in the text.</p></li>
</ol>
</section>
<section id="correlation" class="level3">
<h3 class="anchored" data-anchor-id="correlation">4. Correlation</h3>
<p>This code will a correlation matrix plot to look at the relationship between all the variables/</p>
<ol type="a">
<li><p>Get it running in your report and use the help file for either corrplot or ggcorrmat to change the formatting (might be colors, might be .</p></li>
<li><p>Describe the relationships you see in the text and which (if any) other predictors might be confounding variables.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The [-1] here means remove the first column as it's character based</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the correlation matrix in numbers</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>corr_data <span class="ot">&lt;-</span> <span class="fu">cor</span>(bass[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># And two ways of plotting</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># From ggstatsplot</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(corr_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="in_S462_Lab4_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From the ggcorrplot package</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggcorrmat</span>(bass) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="in_S462_Lab4_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="simple-linear-model" class="level3">
<h3 class="anchored" data-anchor-id="simple-linear-model">5. Simple Linear Model</h3>
<ol type="a">
<li><p>Create a linear model between your response and predictor (remember to read the problem statement to work out what they are). It will make your life easier to save this as a variable called model1. e.g.&nbsp;<code>model1 &lt;- ..</code></p></li>
<li><p>Make a professional looking scatterplot (this should have proper x,y axis labels etc) with the line of best fit plotted from the model. BONUS mark, install the visreg library and use this website to make your plot (https://pbreheny.github.io/visreg/)</p></li>
<li><p>Describe the scatter-plot (e.g.&nbsp;strength, association, outliers etc)</p></li>
<li><p>Print the linear model summary from olsrr.</p></li>
<li><p>Use equatiomatic or any other method to formally write out the linear model equation and coefficients.</p></li>
<li><p>The Mayor doesn’t know regression. Clearly interpret the estimated model parameters (slope &amp; intercept)/model summary-statistics in the the context of the problem, in a way that would be understandable to a policy maker. <br><br> By this I mean explain what the slope/intercept means in terms of fish and florida, highlighting if this is useful or nonsensical (for example, knowing the weight of someone with zero height is not useful). <br></p></li>
<li><p>Tell me the coefficient of determination/percentage of variation explained by your model?</p></li>
</ol>
</section>
<section id="check-line" class="level3">
<h3 class="anchored" data-anchor-id="check-line">6. Check LINE</h3>
<p>We would normally do this first, but we covered it last in class.. I have provided the code, but you can find a full tutorial here explaining how I interpret it. (https://psu-spatial.github.io/stat462-2022/T1_R_Basics.html#12_Checking_LINE_Assumptions )</p>
<ol type="a">
<li>I have assumed that you have called your model model1 and your table, bass. It extracts your predicted y-values, the residuals, the standardised residuals and outlier analysis for each data point. Get this working without errors for you</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a new column with the predicted y value</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>bass<span class="sc">$</span>y_predicted <span class="ot">&lt;-</span> model1<span class="sc">$</span>fitted.values</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a new column with the raw residuals</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>bass<span class="sc">$</span>residuals_m1 <span class="ot">&lt;-</span> model1<span class="sc">$</span>residuals</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a new column with the standardisd/studentised residuals</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># This is from the MASS libary</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>bass<span class="sc">$</span>residuals_m1stud <span class="ot">&lt;-</span> <span class="fu">studres</span>(model1)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a new column with the leverage</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>bass<span class="sc">$</span>x_leverage <span class="ot">&lt;-</span> <span class="fu">ols_leverage</span>(model1)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a new column with the Cook's distance. OLSRR package</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>bass<span class="sc">$</span>cooks.distance <span class="ot">&lt;-</span> <span class="fu">cooks.distance</span>(model1)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Print out the table</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  Lake     Chlorophyll Alkalinity    pH Calcium Mercury y_predicted residuals_m1
  &lt;chr&gt;          &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
1 Alligat…         0.7        5.9   6.1     3      1.53      0.689        0.841 
2 Annie            3.2        3.5   5.1     1.9    1.33      0.703        0.627 
3 Apopka         128.       116     9.1    44.1    0.04      0.0763      -0.0363
4 Blue_Cy…         3.5       39.4   6.9    16.4    0.44      0.503       -0.0628
5 Brick            1.8        2.5   4.6     2.9    1.33      0.708        0.622 
6 Bryant          44.1       19.6   7.3     4.5    0.25      0.613       -0.363 
# ℹ 3 more variables: residuals_m1stud &lt;dbl&gt;, x_leverage &lt;dbl&gt;,
#   cooks.distance &lt;dbl&gt;</code></pre>
</div>
</div>
<ol start="2" type="a">
<li>You can use this command to make an automatic plot of the raw residuals</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From the OLSRR package</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ols_plot_resid_fit</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="in_S462_Lab4_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="3" type="a">
<li><p>Also manually create a plot using the new columns in your table of the studentized residuals (y-axis) vs fitted/predicted y values (x-axis). In the text explain the difference between the two plots.</p></li>
<li><p>Using the plots explain if it meets the assumptions for linearity and equal variance.</p></li>
<li><p>Use this code to explain if it meets the assumptions for normality (we will assume independence for the sake of a shorter lab)</p></li>
</ol>
</section>
<section id="residuals" class="level3">
<h3 class="anchored" data-anchor-id="residuals">7. Residuals</h3>
<p>We will cover these in Friday’s lecture</p>
<ol type="a">
<li>Use <a href="https://psu-spatial.github.io/stat462-2022/T1_R_Basics.html#14_Outliers,_leverage_and_influential_points">this tutorial on outliers</a> to show your workings/R-code/thought process and identify:</li>
</ol>
<!-- -->
<ol type="a">
<li><p>The name of the lake with highest residual mercury value</p></li>
<li><p>The name of the lake with highest leverage</p></li>
<li><p>The name of the lake with highest Cook’s distance</p></li>
</ol>
<p>Remember you can filter and sort the data table in the View command. You can also use commands like max() and identify.</p>
<ol start="2" type="a">
<li>Another analyst looked at your results and suggested that there are four Lakes which appear to be close to Influential Outliers. In your analysis, use Cook’s distance to explain why they think this and identify the Lakes they are worried about. Do you agree with their comment? Explain your reasoning and provide evidence.</li>
</ol>
</section>
<section id="transformations" class="level3">
<h3 class="anchored" data-anchor-id="transformations">8. Transformations</h3>
<p>Linearity appears to be the biggest problem - we are going to see if we can use a transformation to fit the data. We will cover these in next Monday’s lecture</p>
<p>To do this, we create a new column in your dataset and save it as a logtransformation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>bass<span class="sc">$</span>Log_Alkalinity <span class="ot">&lt;-</span> <span class="fu">log</span>(bass<span class="sc">$</span>Alkalinity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="a">
<li>Get this running in the code, then fit a model between your response and Log_Alkilinity, assess it for LINE/outliers and discuss in the text how/why your model has improved.</li>
</ol>
<p>REMEMBER YOU CAN COPY/PASTE YOUR OLD CODE!</p>
<p>Here I am hoping for a professional scatterplot, a description of the model including the mathematical equation written out, an assessment of whether the new model meets each of the assumptions needed for linear regression, if there are any influential outliers and if the R2 value has changed.</p>
<p>Out of the two models you made in this lab, one would you choose and why?</p>
</section>
<section id="new-lake" class="level3">
<h3 class="anchored" data-anchor-id="new-lake">9. New Lake</h3>
<p>Make a new subsection called <code>Analysis Questions</code></p>
<p>The Governor recently had a question from a member if the public who went fishing in a new lake that was not part of the study. We know the alkalinity level of that lake was 40mg/L. The member of the public wants to be 99% sure that they won’t exceed the Florida Health Advisory level for Mercury levels in Fish, which is 1 <span class="math inline">\(\mu g\)</span> of Mercury.</p>
<p>Should they eat the fish? Explain your answer and show your evidence for how you came to your conclusion. You should decide the best model to use.</p>
<p><br></p>
</section>
<section id="more-complex" class="level3">
<h3 class="anchored" data-anchor-id="more-complex">10. More complex</h3>
<p><em>This question is designed to be more difficult and realistic. I will answer points of clarification, but I will not help anyone work through it before the labs are submitted. However I will award partial marks for workings and how far you get</em></p>
<p>The Florida Health Advisory level for Mercury levels in Fish is 1 <span class="math inline">\(\mu g\)</span> of Mercury. The Governor has accepted your model and is requiring state-wide alkalinity tests.</p>
<p>Using your new model, what is your recommended “safety cut-off” value of alkalinity for new lakes? You would like to be 95% sure that you aren’t just seeing this result by chance. Provide evidence/code showing how you got to your answer</p>
<p><br></p>
</section>
</section>
<section id="submitting-your-lab" class="level2">
<h2 class="anchored" data-anchor-id="submitting-your-lab">11. Submitting your Lab</h2>
<p>Remember to save your work throughout and to spell check your writing (next to the save button). Now, press the knit button again. If you have not made any mistakes in the code then R should create a html file in your lab 1 folder which includes your answers. If you look at your lab 1 folder, you should see this there - complete with a very recent time-stamp.</p>
<p>In that folder, double click on the html file. This will open it in your web-browser.<br>
CHECK THAT THIS IS WHAT YOU WANT TO SUBMIT.</p>
<p>If you are on R studio cloud, see Tutorial 1 for how to download your files</p>
<p>Now go to Canvas and submit BOTH your html and your .Rmd file in Lab 1.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="./Figures/Lab1_Basics_2022_fig1.png" class="img-fluid" width="1673"></p>
</div>
</div>
<p><br></p>
<p><br></p>
</section>
</section>
<section id="grading-rubricchecklist" class="level1">
<h1>Grading Rubric/checklist</h1>
<p>See the table below for what this means - 100% is hard to get!</p>
<p><strong>HTML FILE SUBMISSION - 5 marks</strong></p>
<p><strong>RMD CODE SUBMISSION - 5 marks</strong></p>
<p><strong>Professional report 10 MARKS</strong></p>
<p>Full marks for a report you could take into a job interview. You have done things like fully labeled plots using words, your plots look great, written full paragraphs/sentences, used equation formats, sub-headings, used spell check, explained results in clear language, included units, used a theme and table of contents.. You lose marks for each thing that makes it look non-professional. YOU DO NOT LOSE MARKS FOR ENGLISH GRAMMAR!</p>
<p>Hint, there is a spell check by the save button.</p>
<p><strong>Study data, EDA &amp; Correlation - 10 Marks</strong></p>
<p>You have explored the data using the guide. You have created the correlation matrix plot and sensitively described the relationship between your response and your predictors.</p>
<p><strong>First model and LINE - 10 MARKS</strong></p>
<p>You created the model correctly. In your write up you have summarised the model equation (including the coefficients as numbers) &amp; summarising units afterwards.</p>
<p><strong>Residual Analysis - 10 MARKS</strong></p>
<p>You have assessed whether there are outliers and whether they are influential. You have correctly answered the residual questions and shown why.</p>
<p><strong>Transformed model - 10 MARKS</strong></p>
<p>You have correctly refitted and interpreted the transformed models, following section 8.</p>
<p><strong>Prediction - 5 MARKS</strong></p>
<p>You have correctly predicted the new lake in step 13 and talked about multiple regression in Q15</p>
<p><strong>Hard part - 5 MARKS</strong></p>
<p>You have answered the final question correctly and shown your workings/code..</p>
<ul>
<li>1/4 you try anything</li>
<li>(2-3)/4 Right idea but didn’t get far</li>
<li>4/5 nearly there</li>
<li>5/5 perfect</li>
</ul>
<p>[70 points total]</p>
<p>Overall, here is what your lab should correspond to:</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>